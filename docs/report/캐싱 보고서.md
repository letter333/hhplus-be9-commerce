## Cache 보고서
### 개요
조회가 오래 걸리거나, 자주 변핮지 않는 데이터 등에 캐시 적용 시 애플리케이션의 성능 비교 보고서입니다. 

### 필요성 분석
#### 인기 상품 조회
1. 인기 상품 조회는 매일 자정을 기준으로 데이터가 바뀌기 때문에 변화가 거의 없는 데이터이다.
2. 호출이 자주 일어나는 API 이다.
3. 여러 개의 테이블을 JOIN 하여 통계를 내기 때문에 조회 시 DB에 부하가 생길 수 있다.

#### 사용 전략
- **캐시 전략**: Look-Aside 및 1일 TTL로 설정하여 24시간 후 자동으로 삭제
- **캐시 키**: topSellingProducts: + 현재 날짜로 설정하여 매일 갱신

#### 전체 상품 조회
1. 상품 목록은 자주 변경되지 않는 데이터이다.
2. 전체 상품을 매번 DB에서 조회하면 부하가 발생할 수 있다.

#### 사용 전략
- **캐시 키**: products::all
- **TTL**: 상품의 변경을 생각하여 30분으로 설정
- **무효화**: 상품 등록, 주문으로 인한 재고 변경 시

#### 단일 상품 조회
1. 주문을 하지 않고 정보를 확인하기 위해 데이터를 변경시키지 않고 조회하는 경우가 많다.
2. 상세 페이지 등 조회가 자주 일어난다.

#### 사용 전략
- **캐시 키**: product::{id}
- **TTL**: 주문이 발생하는 경우를 생각하여 5분으로 설정
- **무효화**: 주문으로 인한 재고 변경 시, 이후에 상품 수정, 삭제 등의 기능 추가 시

### 성능 테스트
테스트는 K6로 진행하며 지표는 응답 시간, 처리량, 성공률 등을 비교
</br>
가장 많은 성능 차이가 발생할 것으로 예상되는 인기 상품 조회만 대표로 테스트를 진행


#### 캐시가 적용되지 않은 경우
- 전체 검사 결과

| 항목     | 값       | 비율    | 설명           |
|--------|---------|-------|--------------|
| 총 검사 수 | 216,522 | -     | 초당 2,706회 실행 |
| 성공     | 216,492 | 99.98 | 거의 모든 요청 성공  |
| 실패     | 30      | 0.01  | 일부 요청 실패     |

- 응답 시간

| 검증 항목        | 성공/실패 | 상세                      |
|--------------|-------|-------------------------|
| HTTP 상태 200  | 성공    | 모든 요청 성공                |
| 응답시간 < 300ms | 일부 실패 | 108,231성공, 30실패(99% 성공) |

- HTTP 성능

| 지표          | 평균            | 최소     | 중간값     | 최대       | P90     | P95     |
|-------------|---------------|--------|---------|----------|---------|---------|
| 응답 시간       | 34.28ms       | 3.87ms | 29.04ms | 622.39ms | 60.22ms | 79.56ms |
| HTTP 요청 실패율 | 0.00%         | -      | -       | -        | -       | -       |
| 총 HTTP 요청 수 | 108,261개      | -      | -       | -        | -       | -       |
| 초당 요청 수     | 1,353.17req/s |        |         |          |         |         |

#### 캐시가 적용된 경우
- 전체 검사 결과

| 항목     | 값         | 비율      | 설명            |
|--------|-----------|---------|---------------|
| 총 검사 수 | 1,145,292 | -       | 초당 14,316회 실행 |
| 성공     | 1,145,292 | 100.00% | 모든 요청 성공      |
| 실패     | 0        | 0.00%   | 실패 없음         |

- 응답 시간

| 검증 항목        | 성공/실패 | 상세       |
|--------------|-------|----------|
| HTTP 상태 200  | 성공    | 모든 요청 성공 |
| 응답시간 < 300ms | 성공    | 모든 요청 성공 |

- HTTP 성능

| 지표          | 평균            | 최소  | 중간값    | 최대       | P90      | P95     |
|-------------|---------------|-----|--------|----------|----------|---------|
| 응답 시간       | 6.24ms        | 0ms | 5.49ms | 272.09ms | 11.39ms | 13.29ms |
| HTTP 요청 실패율 | 0.00%         | -   | -      | -        | -        | -       |
| 총 HTTP 요청 수 | 572,646개      | -   | -      | -        | -        | -       |
| 초당 요청 수     | 7,158.05req/s |     |        |          |          |         |

### 성능 개선 결과
| 지표 | 캐시 적용 전 | 캐시 적용 후 | 개선율 |
| --- | --- | --- | --- |
| **평균 응답 시간** | 34.28ms | 6.24ms | **-81.8%** ⬇️ |
| **중간값 응답 시간** | 29.04ms | 5.49ms | **-81.1%** ⬇️ |
| **P90 응답 시간** | 60.22ms | 11.39ms | **-81.1%** ⬇️ |
| **P95 응답 시간** | 79.56ms | 13.29ms | **-83.3%** ⬇️ |
| **초당 요청 수** | 1,353 req/s | 7,158 req/s | **+429.3%** ⬆️ |
| **검사 성공률** | 99.98% | 100.00% | **+0.02%** ⬆️ |
| **300ms 기준 초과** | 30개 | 0개 | **-100%** ⬇️ |

### 결론
응답 시간 약 5.5배 개선, 처리량 약 5.3배 개선의 결과를 보여주며 캐시 적용이 성능 개선에 효율적이었음이 확인됨