# Redis를 이용한 랭킹 설계
## 1. 개요
기존 DB와 캐시로 처리되던 인기 상품 조회를 Redis 기반의 시스템으로 변경합니다.
1. **랭킹 데이터 저장 및 조회**: `Sorted Set`을 이용해 기간별 랭킹 데이터를 저장 및 조회
2. **상품 정보 캐싱**: `Key-Value` 형태로 상품 정보를 저장해 빠른 속도 제공

---

## 2. Redis 활용 설계
### 2.1 랭킹 데이터 저장 설계
#### 데이터 구조
- **Key 패턴**: `ranking:daily:{yyyy-MM-dd}`
- **자료구조**: `ZSet` (Sorted Set)
- **구성 요소**:
    - **Member**: 상품 ID
    - **Score**: 판매 수량

#### 주요 기능
- **데이터 누적**: `ZINCRBY`를 사용해 특정 상품의 판매 수량 증가
- **기간별 랭킹 조회**: 특정 기간 동안의 데이터를 합산하여 조회 (`ZUNIONSTORE`)
- **만료 설정**: TTL을 통해 10일 이후 자동 삭제

#### 구현 방법
- **판매 수량 증가**: 결제 완료 시 `ZINCRBY`를 이용하여 랭킹 업데이트
- **다수 날짜 합산**: `ZUNIONSTORE`를 사용해 조회 기간 동안의 랭킹을 합산
- **상위 랭킹 조회**: `ZREVRANGE`로 합산된 랭킹 중 상위 N개를 가져옴

---

### 2.2 상품 정보 저장 설계 (Key-Value)
#### 데이터 구조
- **Key 패턴**: `product:{productId}:summary:v1`
- **TTL 설정**: 5분 ~ 10분의 랜덤 TTL

#### 캐싱 전략
- **Cache-Aside**:
    1. **캐시 조회**: `multiGet()`으로 Key 일괄 조회
    2. **미스 발생**: 캐시가 없는 경우 DB에서 조회
    3. **캐시 저장**: 조회된 데이터를 `multiSet()`으로 Redis에 저장

- **TTL**: 랜덤값(5~10분)으로 설정

#### 구현 방법
- **캐시 조회**: `MGET`으로 캐시에 저장된 상품의 정보를 일괄 조회
- **캐시 저장**: `MSET`으로 조회된 데이터를 일괄 저장